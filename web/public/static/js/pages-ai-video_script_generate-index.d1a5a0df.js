(self["webpackChunkcmi_uni_app"]=self["webpackChunkcmi_uni_app"]||[]).push([[165],{13249:function(t,e,n){var i=n(15437);i.__esModule&&(i=i.default),"string"===typeof i&&(i=[[t.id,i,""]]),i.locals&&(t.exports=i.locals);var o=n(69333).A;o("90f59c34",i,!0,{sourceMap:!1,shadowMode:!1})},32929:function(t,e,n){var i=n(42957);i.__esModule&&(i=i.default),"string"===typeof i&&(i=[[t.id,i,""]]),i.locals&&(t.exports=i.locals);var o=n(69333).A;o("aeecdd84",i,!0,{sourceMap:!1,shadowMode:!1})},2748:function(t,e,n){"use strict";var i;n.d(e,{A:function(){return h}});var o,a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-uni-view",{staticClass:"mol",class:t.className},[n("v-uni-view",{staticClass:"mol-container",style:t.containerStyles},[n("v-uni-view",{staticClass:"mol-content"},[t._t("default")],2)],1),t.enable?n("v-uni-view",{staticClass:"mol-action",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.showMore=!t.showMore}}},[n("v-uni-text",{staticClass:"ml-4 iconfont icon-jinru1"}),t._v(t._s(t.showMore?t.lessText:t.moreText))],1):t._e()],1)},r=[],s=n(92771),c=(n(2008),n(2892),n(26099),n(27495),{props:{threshold:{type:Number,default:100},moreText:{type:String,default:"查看更多"},lessText:{type:String,default:"收起"},disabled:{type:Boolean,default:!1},triggerValue:{type:[Number,String,Boolean,Object,Array],default:function(){return""}}},data:function(){return{showMore:!1,contentHeight:0,inited:!1}},computed:{enable:function(t){var e=t.disabled,n=t.threshold,i=t.contentHeight;return!e&&i>n},className:function(t){var e=t.showMore,n=t.enable,i=t.inited,o=[e?"":"mol-less",n?"":"mol-disabled",i?"mol-inited":""];return o.filter(Boolean).join(" ")},containerStyles:function(t){var e=t.enable,n=t.showMore,i=t.threshold,o=t.contentHeight;return e?"height: ".concat(n?o:i,"px"):""}},watch:{triggerValue:function(){this._debounceDetect()},enable:function(t){t&&this._debounceDetect()}},created:function(){this._debounceDetect=this.$util.debounce(this.detect,50),this._debounceDetect()},methods:{detect:function(){var t=this,e=this.createSelectorQuery();e.select(".mol-content").boundingClientRect(),e.exec((function(e){var n=(0,s.A)(e,1),i=n[0];i&&(t.contentHeight=i.height),t.inited||(t.inited=!0)}))}}}),l=c,u=(n(13249),n(18535)),d=(0,u.A)(l,a,r,!1,null,"786069ee",null,!1,i,o),h=d.exports},56758:function(t,e,n){"use strict";n.r(e),n.d(e,{default:function(){return w}});var i,o={cPage:n(49752).A,customNav:n(88300).A,moreOrLess:n(2748).A,copyButton:n(80656).A,uniPopup:n(30773).A},a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("c-page",{attrs:{"login-required":!0,flex:!0},on:{ready:function(e){arguments[0]=e=t.$handleEvent(e),t.onPageReady.apply(void 0,arguments)}},scopedSlots:t._u([{key:"nav",fn:function(){return[n("custom-nav",{attrs:{"bg-color":"transparent"}})]},proxy:!0}])},[n("v-uni-scroll-view",{staticClass:"absolute left-0 top-0 w-full h-full",attrs:{"scroll-with-animation":!0,"scroll-y":!0,"scroll-into-view":t.scrollIntoView}},[n("v-uni-view",{staticClass:"cmi-form",style:t.loaded?"visibility: visible":"visibility: hidden"},[n("v-uni-view",{staticClass:"cmi-form-item"},[n("v-uni-view",{staticClass:"cmi-form-label relative"},[t._v("脚本内容"),t.isNewRecord&&!t.extractRecord?n("v-uni-view",{staticClass:"cmi-link absolute right-0",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.handleVideoExtractSwitch.apply(void 0,arguments)}}},[n("v-uni-image",{staticClass:"w-24 h-24 align-middle",attrs:{src:"/static/icons/swap-horizontal.svg"}}),t._v("提取视频脚本")],1):t._e()],1),n("more-or-less",{staticClass:"block bg-white br-16",attrs:{threshold:32,"trigger-value":t.record.content,"more-text":"展开并编辑",disabled:t.isNewRecord&&!t.extractRecord}},[n("v-uni-textarea",{staticClass:"cmi-input",staticStyle:{"min-height":"380rpx"},attrs:{placeholder:"请输入脚本内容",maxlength:-1,"auto-height":!0},model:{value:t.record.content,callback:function(e){t.$set(t.record,"content",e)},expression:"record.content"}})],1)],1),n("v-uni-view",{staticClass:"cmi-form-item"},[n("v-uni-view",{staticClass:"cmi-form-label relative"},[t._v("提示词"),n("v-uni-view",{staticClass:"cmi-link absolute right-0",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.handleTemplatePromptImport("generate")}}},[t._v("导入模版")])],1),n("more-or-less",{staticClass:"block bg-white br-16",attrs:{threshold:32,"trigger-value":t.record.prompt,"more-text":"展开并编辑",disabled:t.isNewRecord}},[n("v-uni-textarea",{staticClass:"cmi-input",staticStyle:{"min-height":"200rpx"},attrs:{placeholder:"描述对文章的其他要求。例如：引用名人名言，加入成语，删去XX部分...",maxlength:-1,"auto-height":!0},model:{value:t.record.prompt,callback:function(e){t.$set(t.record,"prompt",e)},expression:"record.prompt"}})],1)],1),n("v-uni-view",{staticClass:"pb-36"},[n("v-uni-button",{staticClass:"cmi-btn",attrs:{type:"primary",disabled:t.generateButtonDisabled},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.handleGenerate.apply(void 0,arguments)}}},[t._v(t._s(t.isNewRecord?"生成脚本":"重新生成"))])],1),n("v-uni-view",{staticClass:"flex flex-column gap-20",attrs:{id:"generated_versions"}},t._l(t.generatedVersions,(function(e,i){return n("v-uni-view",{key:e.id,class:0===i&&t.scrollIntoView?"highlight-version":""},[n("v-uni-view",{staticClass:"flex mb-8"},[t._v("生成脚本"),n("v-uni-text",{staticClass:"color-muted ml-4 fs-12"},[t._v(t._s(e.createTime||""))]),n("v-uni-text",{staticClass:"iconfont icon-shanchu1 ml-auto cmi-link fs-16",on:{click:function(n){arguments[0]=n=t.$handleEvent(n),t.handleDelete(e)}}})],1),n("v-uni-view",{staticClass:"bg-white px-14 py-10 br-8"},[n("v-uni-rich-text",{attrs:{nodes:e.contentHtml}}),n("v-uni-view",{staticClass:"flex gap-8 mt-12"},[n("v-uni-button",{staticClass:"cmi-btn flex-1",attrs:{type:"primary",plain:!0},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.handlePolishRequest(i)}}},[t._v("润色")]),n("copy-button",{staticClass:"cmi-btn cmi-btn-primary flex-1",attrs:{text:e.contentPlainText}},[t._v("复制全文")])],1)],1)],1)})),1)],1)],1),n("uni-popup",{ref:"polishPopup",attrs:{type:"bottom"}},[n("v-uni-view",{staticClass:"bg-white px-20 pb-22",staticStyle:{"border-radius":"32rpx 32rpx 0 0"}},[n("v-uni-view",{staticClass:"py-16 text-center fs-15 font-bold"},[t._v("润色")]),n("v-uni-view",{staticClass:"color-muted mb-8 relative"},[t._v("润色提示词（必填）"),n("v-uni-view",{staticClass:"cmi-link absolute right-0",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.handleTemplatePromptImport("polish")}}},[t._v("导入模版")])],1),n("v-uni-view",{staticClass:"px-8 py-10 br-8 bd-1"},[n("v-uni-textarea",{staticStyle:{width:"100%",height:"560rpx"},attrs:{maxlength:-1,"adjust-keyboard-to":"bottom"},model:{value:t.polishPrompt,callback:function(e){t.polishPrompt=e},expression:"polishPrompt"}})],1),n("v-uni-button",{staticClass:"cmi-btn mt-20",attrs:{type:"primary",disabled:!t.polishPrompt},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.handlePolish.apply(void 0,arguments)}}},[t._v("开始润色")])],1)],1)],1)},r=[],s=n(42727),c=n(31969),l=n(92771),u=n(50575),d=n(49943),h=(n(28706),n(2008),n(62062),n(26099),n(30507)),p=n(7284),v={mixins:[(0,p.A)({use_prompt_template:function(t){var e=t.prompt,n=t.ticket;switch(n){case"generate":this.record.prompt=e;break;case"polish":this.polishPrompt=e;break}}})],data:function(){return{id:"",extractStorageKey:"",extractRecord:null,record:{content:"",prompt:"",versions:[]},polishPrompt:"",actionVersionIndex:-1,loaded:!1,scrollIntoView:""}},computed:{isNewRecord:function(t){var e=t.id;return!e},generateButtonDisabled:function(){return!this.record.content||!this.record.prompt},generatedVersions:function(){var t=this;return this.record.versions.map((function(e){var n=t.$util.markdownToHtml(e.content),i=t.$util.stripHtmlTags(n);return(0,d.A)((0,d.A)({},e),{},{contentHtml:n,contentPlainText:i})}))}},onLoad:function(t){var e=t.id,n=t.extractStorageKey;this.id=e,this.extractStorageKey=n},methods:{onPageReady:function(){var t=this,e=this.id,n=this.extractStorageKey;if(e)(0,h.zp)(e).then((function(e){t.record=(0,d.A)((0,d.A)({},t.record),e.data)})).catch((function(t){uni.showToast({title:t,icon:"none"})})).finally((function(){setTimeout((function(){return t.loaded=!0}),100)}));else if(n){var i=uni.getStorageSync(n);i&&(this.extractRecord=i,uni.removeStorageSync(n),this.record.content=i.content,this.showIntegralDeductionInfo(i.used)),setTimeout((function(){return t.loaded=!0}),100)}else this.loaded=!0},handleVideoExtractSwitch:function(){uni.redirectTo({url:"/pages/ai/video_script_extract/index"})},handleTemplatePromptImport:function(t){uni.navigateTo({url:"/pages/ai/prompt_templates/index?ticket="+t})},handleGenerate:function(){var t=this;return(0,u.A)((0,s.A)().mark((function e(){var n,i,o,a,r,u,d,p,v;return(0,s.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return uni.showLoading({title:"正在生成脚本"}),i=t.record,o=i.content,a=i.prompt,r=t.isNewRecord?(0,h.lX)({original:o,prompt:a,extract_copy_id:null===(n=t.extractRecord)||void 0===n?void 0:n.id,type:"video_script"}):(0,h.g7)(t.id,{original:o,prompt:a}),e.next=5,t.$util.ef(r);case 5:u=e.sent,d=(0,l.A)(u,2),p=d[0],v=d[1],uni.hideLoading(),p?uni.showModal({title:"提示",content:p.message,showCancel:!1}):(t.record.versions=[v.data].concat((0,c.A)(t.record.versions)),t.isNewRecord&&(t.id=v.data.initiation_id),t.showIntegralDeductionInfo(v.data.used),t.scrollToFirstVersion(),uni.$emit("ai_records_updated"));case 11:case"end":return e.stop()}}),e)})))()},handlePolishRequest:function(t){this.actionVersionIndex=t,this.$refs.polishPopup.open()},handlePolish:function(){var t=this;return(0,u.A)((0,s.A)().mark((function e(){var n,i,o,a,r;return(0,s.A)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=t.record.versions[t.actionVersionIndex],n){e.next=3;break}return e.abrupt("return");case 3:return uni.showLoading(),e.next=6,t.$util.ef((0,h.hM)(n.id,{prompt:t.polishPrompt}));case 6:i=e.sent,o=(0,l.A)(i,2),a=o[0],r=o[1],uni.hideLoading(),a?uni.showToast({title:a.message,icon:"none"}):(t.record.versions=[r.data].concat((0,c.A)(t.record.versions)),t.$refs.polishPopup.close(),t.polishPrompt="",t.showIntegralDeductionInfo(r.data.used),t.scrollToFirstVersion(),uni.$emit("ai_records_updated"));case 12:case"end":return e.stop()}}),e)})))()},handleDelete:function(t){var e=this;uni.showModal({title:"是否确认删除？",cancelText:"否",confirmText:"是",success:function(n){n.confirm&&(0,h.jL)(t.id).then((function(){e.record.versions=e.record.versions.filter((function(e){return e.id!==t.id})),uni.showToast({title:"已成功删除",icon:"none"}),uni.$emit("ai_records_updated")})).catch((function(t){console.log(t),uni.showToast({title:"删除失败，请重试",icon:"none"})}))}})},scrollToFirstVersion:function(){var t=this;setTimeout((function(){t.scrollIntoView="generated_versions",setTimeout((function(){t.scrollIntoView=""}),1200)}),50)},showIntegralDeductionInfo:function(t){t>0&&uni.showToast({title:"本次扣除".concat(t,"积分"),icon:"none",duration:5e3})}}},m=v,f=(n(32929),n(18535)),g=(0,f.A)(m,a,r,!1,null,"01752315",null,!1,o,i),w=g.exports},15437:function(t,e,n){"use strict";n.r(e);var i=n(45522),o=n.n(i),a=n(67643),r=n.n(a),s=r()(o());s.push([t.id,'@charset "UTF-8";\n/**\n * 这里是uni-app内置的常用样式变量\n *\n * uni-app 官方扩展插件及插件市场（https://ext.dcloud.net.cn）上很多三方插件均使用了这些样式变量\n * 如果你是插件开发者，建议你使用scss预处理，并在插件代码中直接使用这些变量（无需 import 这个文件），方便用户通过搭积木的方式开发整体风格一致的App\n *\n */\n/**\n * 如果你是App开发者（插件使用者），你可以通过修改这些变量来定制自己的插件主题，实现自定义主题功能\n *\n * 如果你的项目同样使用了scss预处理，你也可以直接在你的 scss 代码中使用如下变量，同时无需 import 这个文件\n */\n/* 颜色变量 */\n/* 行为相关颜色 */\n/* 背景颜色 */\n/* 边框颜色 */\n/* 尺寸变量 */\n/* 文字尺寸 */\n/* 图片尺寸 */\n/* Border Radius */\n/* 水平间距 */\n/* 垂直间距 */\n/* 透明度 */\n/* 文章场景相关 */.mol[data-v-786069ee]{position:relative;visibility:hidden}.mol-inited[data-v-786069ee]{visibility:visible}.mol-container[data-v-786069ee]{overflow:hidden;transition:height .3s ease-in-out}.mol-action[data-v-786069ee]{text-align:center;padding:%?16?%;color:var(--view-theme);font-size:%?28?%}.mol-action .iconfont[data-v-786069ee]{display:inline-block;margin-right:%?8?%;font-size:%?26?%;-webkit-transform:rotate(-90deg);transform:rotate(-90deg)}.mol-less:not(.mol-disabled) .mol-container .mol-content[data-v-786069ee]{pointer-events:none}.mol-less .mol-action .iconfont[data-v-786069ee]{-webkit-transform:rotate(90deg);transform:rotate(90deg)}',""]),e["default"]=s},42957:function(t,e,n){"use strict";n.r(e);var i=n(45522),o=n.n(i),a=n(67643),r=n.n(a),s=r()(o());s.push([t.id,'@charset "UTF-8";\n/**\n * 这里是uni-app内置的常用样式变量\n *\n * uni-app 官方扩展插件及插件市场（https://ext.dcloud.net.cn）上很多三方插件均使用了这些样式变量\n * 如果你是插件开发者，建议你使用scss预处理，并在插件代码中直接使用这些变量（无需 import 这个文件），方便用户通过搭积木的方式开发整体风格一致的App\n *\n */\n/**\n * 如果你是App开发者（插件使用者），你可以通过修改这些变量来定制自己的插件主题，实现自定义主题功能\n *\n * 如果你的项目同样使用了scss预处理，你也可以直接在你的 scss 代码中使用如下变量，同时无需 import 这个文件\n */\n/* 颜色变量 */\n/* 行为相关颜色 */\n/* 背景颜色 */\n/* 边框颜色 */\n/* 尺寸变量 */\n/* 文字尺寸 */\n/* 图片尺寸 */\n/* Border Radius */\n/* 水平间距 */\n/* 垂直间距 */\n/* 透明度 */\n/* 文章场景相关 */@-webkit-keyframes ani-highlight-version-data-v-01752315{0%{-webkit-transform:translateY(0);transform:translateY(0)}50%{-webkit-transform:translateY(0);transform:translateY(0)}99%{-webkit-transform:translateY(100%);transform:translateY(100%);opacity:1}100%{opacity:0;display:none}}@keyframes ani-highlight-version-data-v-01752315{0%{-webkit-transform:translateY(0);transform:translateY(0)}50%{-webkit-transform:translateY(0);transform:translateY(0)}99%{-webkit-transform:translateY(100%);transform:translateY(100%);opacity:1}100%{opacity:0;display:none}}.highlight-version[data-v-01752315]{position:relative;overflow:hidden}.highlight-version[data-v-01752315]::after{content:"";position:absolute;left:0;top:0;width:100%;height:100%;background:linear-gradient(180deg,transparent,#fff 5%);z-index:1;pointer-events:none;-webkit-animation:ani-highlight-version-data-v-01752315 1s linear forwards;animation:ani-highlight-version-data-v-01752315 1s linear forwards}',""]),e["default"]=s},7284:function(t,e,n){"use strict";n.d(e,{A:function(){return i}});n(28706),n(44114),n(79432),n(26099),n(23500);function i(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=Object.keys(t);return 0===e.length?{}:{onLoad:function(){var n=this;this._mixin_geh_event_queue=[],this._mixin_geh_event_queue_inner_handlers={},e.forEach((function(e){n._mixin_geh_event_queue_inner_handlers[e]=function(){for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];n._mixin_geh_event_queue.push((function(){var i;return null===(i=t[e])||void 0===i?void 0:i.call.apply(i,[n].concat(o))}))},uni.$on(e,n._mixin_geh_event_queue_inner_handlers[e])}))},onShow:function(){this._mixin_geh_event_queue.forEach((function(t){return t()})),this._mixin_geh_event_queue=[]},onUnload:function(){var t=this;e.forEach((function(e){uni.$off(e,t._mixin_geh_event_queue_inner_handlers[e])}))}}}}}]);